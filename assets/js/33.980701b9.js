(window.webpackJsonp=window.webpackJsonp||[]).push([[33],{323:function(t,s,a){"use strict";a.r(s);var n=a(10),e=Object(n.a)({},(function(){var t=this,s=t._self._c;return s("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[s("h1",{attrs:{id:"通过内置goners支持配置文件"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#通过内置goners支持配置文件"}},[t._v("#")]),t._v(" 通过内置Goners支持配置文件")]),t._v(" "),s("p"),s("div",{staticClass:"table-of-contents"},[s("ul",[s("li",[s("a",{attrs:{href:"#举个例子"}},[t._v("举个例子")]),s("ul",[s("li",[s("a",{attrs:{href:"#_1-创建mod"}},[t._v("1. 创建mod")])]),s("li",[s("a",{attrs:{href:"#_2-添加配置文件"}},[t._v("2. 添加配置文件")])]),s("li",[s("a",{attrs:{href:"#_3-添加代码"}},[t._v("3. 添加代码")])]),s("li",[s("a",{attrs:{href:"#_4-运行"}},[t._v("4. 运行")])])])]),s("li",[s("a",{attrs:{href:"#配置注入"}},[t._v("配置注入")]),s("ul",[s("li",[s("a",{attrs:{href:"#使用的标签格式"}},[t._v("使用的标签格式")])]),s("li",[s("a",{attrs:{href:"#支持注入的数据类型"}},[t._v("支持注入的数据类型")])]),s("li",[s("a",{attrs:{href:"#配置文件"}},[t._v("配置文件")])])])])])]),s("p"),t._v(" "),s("p",[t._v("在gone中提供了通过内置Goners读取配置文件的方法，配置文件格式暂时只支持"),s("code",[t._v(".properties")]),t._v("。")]),t._v(" "),s("h2",{attrs:{id:"举个例子"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#举个例子"}},[t._v("#")]),t._v(" 举个例子")]),t._v(" "),s("blockquote",[s("p",[t._v("例子的代码源代码可以在"),s("a",{attrs:{href:"https://github.com/gone-io/gone/tree/main/example/use-config",target:"_blank",rel:"noopener noreferrer"}},[t._v("这里"),s("OutboundLink")],1),t._v("找到。")])]),t._v(" "),s("h3",{attrs:{id:"_1-创建mod"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_1-创建mod"}},[t._v("#")]),t._v(" 1. 创建mod")]),t._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[t._v("go mod init use-config\n")])])]),s("h3",{attrs:{id:"_2-添加配置文件"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_2-添加配置文件"}},[t._v("#")]),t._v(" 2. 添加配置文件")]),t._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[s("span",{pre:!0,attrs:{class:"token function"}},[t._v("mkdir")]),t._v(" config\n"),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("touch")]),t._v(" config/default.properties\n")])])]),s("p",[t._v("config/default.properties 文件内容如下：")]),t._v(" "),s("div",{staticClass:"language-properties extra-class"},[s("pre",{pre:!0,attrs:{class:"language-properties"}},[s("code",[s("span",{pre:!0,attrs:{class:"token key attr-name"}},[t._v("my.conf.int")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token value attr-value"}},[t._v("10")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token key attr-name"}},[t._v("my.conf.int8")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token value attr-value"}},[t._v("130")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token key attr-name"}},[t._v("my.conf.float64")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token value attr-value"}},[t._v("10.222")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token key attr-name"}},[t._v("my.conf.string")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token value attr-value"}},[t._v("config test")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token key attr-name"}},[t._v("my.conf.bool")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token value attr-value"}},[t._v("true")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token key attr-name"}},[t._v("my.conf.duration")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token value attr-value"}},[t._v("10h")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token key attr-name"}},[t._v("my.conf.sub.x")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token value attr-value"}},[t._v("100x")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token key attr-name"}},[t._v("my.conf.sub.y")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token value attr-value"}},[t._v("200y")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token key attr-name"}},[t._v("my.conf.subs[0].x")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token value attr-value"}},[t._v("0000x")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token key attr-name"}},[t._v("my.conf.subs[0].y")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token value attr-value"}},[t._v("0000y")]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token key attr-name"}},[t._v("my.conf.subs[1].x")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token value attr-value"}},[t._v("1111x")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token key attr-name"}},[t._v("my.conf.subs[1].y")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token value attr-value"}},[t._v("1111y")]),t._v("\n")])])]),s("h3",{attrs:{id:"_3-添加代码"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_3-添加代码"}},[t._v("#")]),t._v(" 3. 添加代码")]),t._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[s("span",{pre:!0,attrs:{class:"token function"}},[t._v("touch")]),t._v(" main.go\n")])])]),s("p",[t._v("main.go 文件内容如下：")]),t._v(" "),s("div",{staticClass:"language-go extra-class"},[s("pre",{pre:!0,attrs:{class:"language-go"}},[s("code",[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("package")]),t._v(" main\n\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("\n\t"),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"fmt"')]),t._v("\n\t"),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"github.com/gone-io/gone"')]),t._v("\n\t"),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"github.com/gone-io/gone/goner/config"')]),t._v("\n\t"),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"time"')]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("type")]),t._v(" SubConf "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("struct")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n\tX "),s("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("string")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('`properties:"x"`')]),t._v("\n\tY "),s("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("string")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('`properties:"y"`')]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("type")]),t._v(" UseConfig "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("struct")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n\tgone"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("Flag\n\n\t"),s("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("int")]),t._v("      "),s("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("int")]),t._v("           "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('`gone:"config,my.conf.int"`')]),t._v("\n\t"),s("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("int8")]),t._v("     "),s("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("int8")]),t._v("          "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('`gone:"config,my.conf.int8"`')]),t._v("\n\tprintInt "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),s("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("int")]),t._v("          "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('`gone:"config,my.conf.int8"`')]),t._v(" "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//指针 指向int")]),t._v("\n\t"),s("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("float64")]),t._v("  "),s("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("float64")]),t._v("       "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('`gone:"config,my.conf.float64"`')]),t._v("\n\t"),s("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("string")]),t._v("   "),s("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("string")]),t._v("        "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('`gone:"config,my.conf.string"`')]),t._v("\n\t"),s("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("bool")]),t._v("     "),s("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("bool")]),t._v("          "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('`gone:"config,my.conf.bool"`')]),t._v("\n\tduration time"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("Duration "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('`gone:"config,my.conf.duration"`')]),t._v("\n\tdefaultV "),s("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("string")]),t._v("        "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('`gone:"config,my.conf.default,default=ok"`')]),t._v("\n\n\tsub "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),t._v("SubConf "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('`gone:"config,my.conf.sub"`')]),t._v(" "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//指针，指向结构体")]),t._v("\n\n\tsubs "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("SubConf "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('`gone:"config,my.conf.subs"`')]),t._v(" "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//数组")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("func")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("g "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),t._v("UseConfig"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("AfterRevive")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" gone"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("AfterReviveError "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n\tfmt"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("Printf")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"int=%d\\n"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" g"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("int")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\tfmt"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("Printf")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"int8=%d\\n"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" g"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("int8")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\tfmt"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("Printf")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"printInt=%d\\n"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),t._v("g"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("printInt"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\tfmt"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("Printf")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"float64=%f\\n"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" g"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("float64")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\tfmt"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("Printf")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"string=%s\\n"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" g"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("string")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\tfmt"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("Printf")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"bool=%t\\n"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" g"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("bool")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\tfmt"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("Printf")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"duration=%v\\n"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" g"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("duration"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\tfmt"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("Printf")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"defaultV=%s\\n"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" g"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("defaultV"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\tfmt"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("Printf")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"sub.x=%v\\n"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" g"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("sub"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\tfmt"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("Printf")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"subs=%v\\n"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" g"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("subs"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\n\t"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("nil")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("func")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("main")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n\tgone"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("Run")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("func")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("cemetery gone"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("Cemetery"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("error")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n\t\t"),s("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("_")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" config"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("Priest")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("cemetery"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\t\tcemetery"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("Bury")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("&")]),t._v("UseConfig"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\t\t"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("nil")]),t._v("\n\t"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),s("h3",{attrs:{id:"_4-运行"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_4-运行"}},[t._v("#")]),t._v(" 4. 运行")]),t._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[t._v("go mod tidy\ngo run main.go\n")])])]),s("p",[t._v("运行结果如下：")]),t._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[t._v("int=10\nint8=-126\nprintInt=130\nfloat64=10.222000\nstring=config test\nbool=true\nduration=10h0m0s\ndefaultV=ok\nsub.x=&{100x 200y}\nsubs=[{0000x 0000y} {1111x 1111y}]\n")])])]),s("h2",{attrs:{id:"配置注入"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#配置注入"}},[t._v("#")]),t._v(" 配置注入")]),t._v(" "),s("p",[t._v("从例子中可以看到，配置项也可以通过“依赖注入”到Goner。")]),t._v(" "),s("h3",{attrs:{id:"使用的标签格式"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#使用的标签格式"}},[t._v("#")]),t._v(" 使用的标签格式")]),t._v(" "),s("p",[t._v("配置注入的标签格式如下：")]),t._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[t._v('gone:"config,${key},default=${defaultValue}"\n')])])]),s("div",{staticClass:"custom-block tip"},[s("p",{staticClass:"custom-block-title"},[t._v("其中含义如下:")]),t._v(" "),s("ol",[s("li",[t._v("标签名依然为"),s("code",[t._v("gone")])]),t._v(" "),s("li",[s("code",[t._v("config")]),t._v("为固定值，表示该属性为配置")]),t._v(" "),s("li",[s("code",[t._v("${key}")]),t._v("为配置在配置文件中的key")]),t._v(" "),s("li",[s("code",[t._v("default=${defaultValue}")]),t._v("用于指定默认值，可以省略；"),s("code",[t._v("${defaultValue}")]),t._v("为默认值；如果没有指定默认值；如果配置文件中缺少对应key，则会报错")])])]),t._v(" "),s("h3",{attrs:{id:"支持注入的数据类型"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#支持注入的数据类型"}},[t._v("#")]),t._v(" 支持注入的数据类型")]),t._v(" "),s("blockquote",[s("p",[t._v("在 "),s("a",{attrs:{href:"https://goner.fun/zh/guide/core-concept.html#goner-%E9%80%9D%E8%80%85",target:"_blank",rel:"noopener noreferrer"}},[t._v("核心概念-Goner"),s("OutboundLink")],1),t._v("中，我们讲到Goner可以被注入到其他结构体的属性上；这里，配置作为一种特殊情况，也可以被注入到其他结构体的属性上，他的实现是通过的"),s("a",{attrs:{href:"https://goner.fun/zh/guide/core-concept.html#%F0%9F%A7%9B%F0%9F%8F%BB%E2%80%8D%E2%99%80%EF%B8%8Fvampire-%E5%90%B8%E8%A1%80%E9%AC%BC",target:"_blank",rel:"noopener noreferrer"}},[t._v("Vampire（吸血鬼）"),s("OutboundLink")],1),t._v("，如果感觉兴趣，可以看"),s("a",{attrs:{href:"https://github.com/gone-io/gone/tree/v0.1.5/goner/config",target:"_blank",rel:"noopener noreferrer"}},[t._v("这部分源代码"),s("OutboundLink")],1),t._v("。")])]),t._v(" "),s("p",[t._v("属性支持的类型，列举如下：")]),t._v(" "),s("ol",[s("li",[t._v("基础类型\n"),s("ul",[s("li",[t._v("布尔型：bool")]),t._v(" "),s("li",[t._v("整数类型：int, int64, int32, int16, int8")]),t._v(" "),s("li",[t._v("非负整数类型：uint, uint64, uint32, uint16, uint8")]),t._v(" "),s("li",[t._v("浮点型：float64, float32")]),t._v(" "),s("li",[t._v("字符串类型：string")])])])]),t._v(" "),s("div",{staticClass:"custom-block tip"},[s("p",{staticClass:"custom-block-title"},[t._v("提示")]),t._v(" "),s("p",[t._v("整数类型和非负整数类型，需要注意数据结构表示的数的范围，数字过大可能会溢出；比如"),s("code",[t._v("int8")]),t._v("表示的范围是"),s("code",[t._v("-128")]),t._v(" ~ "),s("code",[t._v("127")]),t._v("，如果用其接收一个大于127的配置就会发生溢出（配置128将得到-128）。")])]),t._v(" "),s("ol",{attrs:{start:"2"}},[s("li",[t._v("time.Duration\n为方便时间的解析，支持了"),s("code",[t._v("time.Duration")]),t._v("类型的配置，可以使用下面的单位：\n"),s("ul",[s("li",[t._v("ns 纳秒")]),t._v(" "),s("li",[t._v("us 微秒")]),t._v(" "),s("li",[t._v("ms 毫秒")]),t._v(" "),s("li",[t._v("s 秒")]),t._v(" "),s("li",[t._v("m 分钟")]),t._v(" "),s("li",[t._v("h 小时")])])])]),t._v(" "),s("p",[t._v("在例子中，"),s("code",[t._v("my.conf.duration=10h")]),t._v("单位为h，表示10个小时；"),s("code",[t._v("1h10m10s")]),t._v("则表示1小时10分10秒。")]),t._v(" "),s("div",{staticClass:"custom-block tip"},[s("p",{staticClass:"custom-block-title"},[t._v("提示")]),t._v(" "),s("p",[t._v("实现采用的"),s("code",[t._v("time.ParseDuration")]),t._v("，所以可以参考："),s("a",{attrs:{href:"https://pkg.go.dev/time#ParseDuration",target:"_blank",rel:"noopener noreferrer"}},[t._v("https://pkg.go.dev/time#ParseDuration"),s("OutboundLink")],1)])]),t._v(" "),s("ol",{attrs:{start:"3"}},[s("li",[t._v("结构体类型\n在例子中，给出了配置结构体的类型，需要满足如下规则：\n"),s("ul",[s("li",[t._v("结构体中需要配置的属性为公开的，即大写字母打头")]),t._v(" "),s("li",[t._v("使用"),s("code",[t._v("properties")]),t._v("标签指定属性的名字")]),t._v(" "),s("li",[t._v("支持嵌套")])])])]),t._v(" "),s("p",[t._v("说明：在例子中"),s("code",[t._v("UseConfig")]),t._v("的属性"),s("code",[t._v("sub")]),t._v("要读取的配置key为"),s("code",[t._v("my.conf.sub")]),t._v("；"),s("code",[t._v("sub")]),t._v("的类型为"),s("code",[t._v("SubConf")]),t._v("，标注了属性"),s("code",[t._v("X")]),t._v("的配置名为"),s("code",[t._v('properties:"x"')]),t._v("，那么"),s("code",[t._v("sub.X")]),t._v("的值将读取配置项"),s("code",[t._v("my.conf.sub.x")]),t._v("。")]),t._v(" "),s("ol",{attrs:{start:"4"}},[s("li",[t._v("数组类型\n配置的注入支持Slice类型，Slice的元素目前只支持结构体、结构体的指针；配置的key形式如下：")])]),t._v(" "),s("div",{staticClass:"language-ini extra-class"},[s("pre",{pre:!0,attrs:{class:"language-ini"}},[s("code",[t._v("${injectConfigkey}[${index}].${structAttributeName}\n")])])]),s("div",{staticClass:"custom-block tip"},[s("p",{staticClass:"custom-block-title"},[t._v("说明")]),t._v(" "),s("ul",[s("li",[s("code",[t._v("${injectConfigkey}")]),t._v("为待注入项的key")]),t._v(" "),s("li",[s("code",[t._v("${index}")]),t._v("为数组下标")]),t._v(" "),s("li",[s("code",[t._v("${structAttributeName}")]),t._v("为被注入结构体的属性上的"),s("code",[t._v("properties")]),t._v("标注的值")])])]),t._v(" "),s("ol",{attrs:{start:"5"}},[s("li",[t._v("指针类型\n支持被注入属性的类型为指针。")])]),t._v(" "),s("h3",{attrs:{id:"配置文件"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#配置文件"}},[t._v("#")]),t._v(" 配置文件")]),t._v(" "),s("h4",{attrs:{id:"配置文件目录"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#配置文件目录"}},[t._v("#")]),t._v(" 配置文件目录")]),t._v(" "),s("p",[t._v("配置文件存放的目录由三部分决定：")]),t._v(" "),s("ol",[s("li",[t._v("可执行文件和程序当前工作路径")]),t._v(" "),s("li",[t._v("相对配置目录\n相对配置目录默认是"),s("code",[t._v("config")]),t._v("，可以通过启动传参"),s("code",[t._v("--conf $configDir")]),t._v("来改变")])]),t._v(" "),s("p",[t._v("举个例子，如果编译后的gone程序保存为"),s("code",[t._v("/app/gone-app")]),t._v("，我们进入"),s("code",[t._v("/home/degfy")]),t._v("目录运行：")]),t._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("cd")]),t._v(" /home/degfy/\n/app/gone-app\n")])])]),s("p",[t._v("并没有通过传参修改相对配置目录，那么该程序的配置目录为：")]),t._v(" "),s("ul",[s("li",[t._v("/app/config")]),t._v(" "),s("li",[t._v("/home/degfy/config")])]),t._v(" "),s("h4",{attrs:{id:"默认配置文件路径"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#默认配置文件路径"}},[t._v("#")]),t._v(" 默认配置文件路径")]),t._v(" "),s("p",[t._v("沿用前面的例子，配置文件的路径为：")]),t._v(" "),s("ul",[s("li",[t._v("/app/config/default.properties")]),t._v(" "),s("li",[t._v("/home/degfy/config/default.properties\n这个两个配置文件中的配置为默认配置，是不随环境改变而改变的。")])]),t._v(" "),s("h4",{attrs:{id:"环境相关配置文件路径"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#环境相关配置文件路径"}},[t._v("#")]),t._v(" 环境相关配置文件路径")]),t._v(" "),s("p",[t._v("开发过程中，我们一般会分环境配置，一般情况会分为：")]),t._v(" "),s("ul",[s("li",[t._v("local 本地开发环境")]),t._v(" "),s("li",[t._v("dev 线上开发环境")]),t._v(" "),s("li",[t._v("test 线上测试环境")]),t._v(" "),s("li",[t._v("prod 生成环境")])]),t._v(" "),s("p",[t._v("我们可以通过环境变量"),s("code",[t._v("ENV")]),t._v("或者在启动时传参"),s("code",[t._v("--nev $env")]),t._v("来指定当前环境，如果都没有设置，默认环境是"),s("code",[t._v("local")]),t._v("。\n沿用前面的例子，与环境相关的配置文件为：")]),t._v(" "),s("ul",[s("li",[t._v("/app/config/local.properties")]),t._v(" "),s("li",[t._v("/home/degfy/config/local.properties")])]),t._v(" "),s("h4",{attrs:{id:"配置加载的顺序"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#配置加载的顺序"}},[t._v("#")]),t._v(" 配置加载的顺序")]),t._v(" "),s("p",[t._v("从前面，我们可以得知我们启动时会存在4个配置文件，他们的加载顺序如下：")]),t._v(" "),s("ol",[s("li",[t._v("/app/config/default.properties")]),t._v(" "),s("li",[t._v("/app/config/local.properties")]),t._v(" "),s("li",[t._v("/home/degfy/config/default.properties")]),t._v(" "),s("li",[t._v("/home/degfy/config/local.properties")])]),t._v(" "),s("p",[t._v("如果这些配置文件中存在相同的配置项，后加载的值会先加载的值。也就是环境相关的配置会覆盖默认的配置，当前运行路径的配置会覆盖程序所在目录的配置。")]),t._v(" "),s("div",{staticClass:"custom-block tip"},[s("p",{staticClass:"custom-block-title"},[t._v("最佳实践")]),t._v(" "),s("ol",[s("li",[t._v("将所有配置放到默认配置文件中；在环境相关配置文件中根据环境的需要进行覆盖；")]),t._v(" "),s("li",[t._v("配置的设计应该尽量少，推荐采用“约定优配置”思路来进行设计，配置可以考虑赋予默认值；")]),t._v(" "),s("li",[t._v("为了使代码“开箱可用”，推荐在local.properties中设置完整的配置，让程序不需要任何其他的配置就能运行，让其他小伙伴clone代码后就能丝滑启动程序。")])])])])}),[],!1,null,null,null);s.default=e.exports}}]);