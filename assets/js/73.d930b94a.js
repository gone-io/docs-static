(window.webpackJsonp=window.webpackJsonp||[]).push([[73],{363:function(t,s,a){"use strict";a.r(s);var n=a(10),r=Object(n.a)({},(function(){var t=this,s=t._self._c;return s("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[s("h1",{attrs:{id:"goner-zap-使用说明"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#goner-zap-使用说明"}},[t._v("#")]),t._v(" "),s("code",[t._v("goner/zap")]),t._v(" 使用说明")]),t._v(" "),s("h2",{attrs:{id:"注册到gone"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#注册到gone"}},[t._v("#")]),t._v(" 注册到Gone")]),t._v(" "),s("div",{staticClass:"language-go extra-class"},[s("pre",{pre:!0,attrs:{class:"language-go"}},[s("code",[t._v("\t"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//注册 `goner/zap` 相关的Goners")]),t._v("\n\t"),s("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("_")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" goner"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("ZapLoggerPriest")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("cemetery"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])])]),s("p",[t._v("注意：应该将"),s("code",[t._v("goner/zap")]),t._v("注册的注册放到其他Goners注册之前，如果zap注册了，默认使用的logrus就不会再注册，反之如果logrus注册了，zap就不会再注册。")]),t._v(" "),s("h2",{attrs:{id:"使用-sugar-logger"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#使用-sugar-logger"}},[t._v("#")]),t._v(" 使用 sugar logger")]),t._v(" "),s("div",{staticClass:"language-go extra-class"},[s("pre",{pre:!0,attrs:{class:"language-go"}},[s("code",[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("type")]),t._v(" MyService "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("struct")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    gone"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("Flag\n    gone"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("Logger "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('`gone:"*"`')]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("func")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("s "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),t._v("MyService"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("print")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    s"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("Info")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"hello gone"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),s("p",[t._v("gone.Logger 接口的实现使用的就是zap sugar，所以直接注入"),s("code",[t._v("gone.Logger")]),t._v("，就可以直接使用zap sugar了。")]),t._v(" "),s("h2",{attrs:{id:"使用-zap-logger"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#使用-zap-logger"}},[t._v("#")]),t._v(" 使用 zap logger")]),t._v(" "),s("div",{staticClass:"language-go extra-class"},[s("pre",{pre:!0,attrs:{class:"language-go"}},[s("code",[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("type")]),t._v(" MyService "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("struct")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    gone"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("Flag\n    gone_zap"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("Logger "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('`gone:"*"`')]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("func")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("s "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),t._v("MyService"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("print")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    ctr"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("Info")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"print"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" zap"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("String")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"name"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"gone"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),s("p",[t._v("通过注入"),s("code",[t._v("gone_zap.Logger")]),t._v("，就可以直接使用zap logger了。")]),t._v(" "),s("h2",{attrs:{id:"provider模式-给当前模块提供logger"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#provider模式-给当前模块提供logger"}},[t._v("#")]),t._v(" provider模式，给当前模块提供logger")]),t._v(" "),s("ul",[s("li",[t._v("sugar logger")])]),t._v(" "),s("div",{staticClass:"language-go extra-class"},[s("pre",{pre:!0,attrs:{class:"language-go"}},[s("code",[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("type")]),t._v(" MyService "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("struct")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    gone"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("Flag\n    gone"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("Logger "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('`gone:"zap,my-service"`')]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("func")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("s "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),t._v("MyService"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("print")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n      s"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("Info")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"hello gone"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),s("p",[t._v("上面代码将创建一个新的名为 "),s("code",[t._v("my-service")]),t._v(" 的 sugar logger。")]),t._v(" "),s("ul",[s("li",[t._v("zap logger")])]),t._v(" "),s("div",{staticClass:"language-go extra-class"},[s("pre",{pre:!0,attrs:{class:"language-go"}},[s("code",[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("type")]),t._v(" MyService "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("struct")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    gone"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("Flag\n    gone_zap"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("Logger "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('`gone:"zap,my-service"`')]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("func")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("s "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),t._v("MyService"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("print")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    ctr"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("Info")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"print"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" zap"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("String")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"name"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"gone"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),s("p",[t._v("上面代码将创建一个新的名为 "),s("code",[t._v("my-service")]),t._v(" 的 zap logger。")]),t._v(" "),s("h2",{attrs:{id:"配置项"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#配置项"}},[t._v("#")]),t._v(" 配置项")]),t._v(" "),s("p",[s("code",[t._v("goner/zap")]),t._v("支持通过配置，改变默认行为；关于配置的读取和配置文件的格式参考 "),s("a",{attrs:{href:"https://goner.fun/zh/guide/goner-config.html",target:"_blank",rel:"noopener noreferrer"}},[t._v("配置读取"),s("OutboundLink")],1)]),t._v(" "),s("table",[s("thead",[s("tr",[s("th",[t._v("配置项")]),t._v(" "),s("th",[t._v("说明")]),t._v(" "),s("th",[t._v("类型")]),t._v(" "),s("th",[t._v("默认值")])])]),t._v(" "),s("tbody",[s("tr",[s("td",[t._v("log.level")]),t._v(" "),s("td",[t._v("日志级别，支持 debug、info、warn、error、panic、fatal")]),t._v(" "),s("td",[t._v("string")]),t._v(" "),s("td",[t._v("info")])]),t._v(" "),s("tr",[s("td",[t._v("log.enable-trace-id")]),t._v(" "),s("td",[t._v("是否开启traceId，开启traceId后，日志会增加traceId字段")]),t._v(" "),s("td",[t._v("bool")]),t._v(" "),s("td",[t._v("true")])]),t._v(" "),s("tr",[s("td",[t._v("log.disable-stacktrace")]),t._v(" "),s("td",[t._v("是否禁用堆栈信息，禁用堆栈信息后，日志不会增加堆栈信息")]),t._v(" "),s("td",[t._v("bool")]),t._v(" "),s("td",[t._v("false")])]),t._v(" "),s("tr",[s("td",[t._v("log.stacktrace-level")]),t._v(" "),s("td",[t._v("输出日志时同时打印堆栈信息的级别，支持 debug、info、warn、error、panic、fatal")]),t._v(" "),s("td",[t._v("string")]),t._v(" "),s("td",[t._v("error")])]),t._v(" "),s("tr",[s("td",[t._v("log.report-caller")]),t._v(" "),s("td",[t._v("是否打印调用方信息，包括文件名、代码行号和函数名")]),t._v(" "),s("td",[t._v("bool")]),t._v(" "),s("td",[t._v("true")])]),t._v(" "),s("tr",[s("td",[t._v("log.encoder")]),t._v(" "),s("td",[t._v("日志格式，支持 console、json")]),t._v(" "),s("td",[t._v("string")]),t._v(" "),s("td",[t._v("console")])]),t._v(" "),s("tr",[s("td",[t._v("log.output")]),t._v(" "),s("td",[t._v("日志输出位置，支持 stdout、stderr、file，如果配置了file，则日志会输出到file指定的位置；支持多个路径，使用"),s("code",[t._v(",")]),t._v("分隔")]),t._v(" "),s("td",[t._v("string")]),t._v(" "),s("td",[t._v("stdout")])]),t._v(" "),s("tr",[s("td",[t._v("log.error-output")]),t._v(" "),s("td",[t._v("错误日志输出位置，支持 stdout、stderr、file，如果配置了file，则日志会输出到file指定的位置；支持多个路径，使用"),s("code",[t._v(",")]),t._v("分隔")]),t._v(" "),s("td",[t._v("string")]),t._v(" "),s("td",[t._v("<空>")])]),t._v(" "),s("tr",[s("td",[t._v("log.rotation.output")]),t._v(" "),s("td",[t._v("日志轮转输出位置，支持 stdout、stderr、file，如果配置了file，则日志会输出到file指定的位置；配置后开启日志轮转")]),t._v(" "),s("td",[t._v("string")]),t._v(" "),s("td",[t._v("<空>")])]),t._v(" "),s("tr",[s("td",[t._v("log.rotation.error-output")]),t._v(" "),s("td",[t._v("错误日志轮转输出位置，支持 stdout、stderr、file，如果配置了file，则日志会输出到file指定的位置；配置后开启错误日志轮转")]),t._v(" "),s("td",[t._v("string")]),t._v(" "),s("td",[t._v("<空>")])]),t._v(" "),s("tr",[s("td",[t._v("log.rotation.max-size")]),t._v(" "),s("td",[t._v("日志轮转，文件最大大小，单位MB")]),t._v(" "),s("td",[t._v("int")]),t._v(" "),s("td",[t._v("100")])]),t._v(" "),s("tr",[s("td",[t._v("log.rotation.max-files")]),t._v(" "),s("td",[t._v("日志轮转，文件最大数量")]),t._v(" "),s("td",[t._v("int")]),t._v(" "),s("td",[t._v("10")])]),t._v(" "),s("tr",[s("td",[t._v("log.rotation.max-age")]),t._v(" "),s("td",[t._v("日志轮转，文件最大保存天数")]),t._v(" "),s("td",[t._v("int")]),t._v(" "),s("td",[t._v("30")])]),t._v(" "),s("tr",[s("td",[t._v("log.rotation.local-time")]),t._v(" "),s("td",[t._v("日志文件轮转是否使用本地时间戳")]),t._v(" "),s("td",[t._v("bool")]),t._v(" "),s("td",[t._v("true")])]),t._v(" "),s("tr",[s("td",[t._v("log.rotation.compress")]),t._v(" "),s("td",[t._v("日志轮转文件是否压缩")]),t._v(" "),s("td",[t._v("bool")]),t._v(" "),s("td",[t._v("false")])])])])])}),[],!1,null,null,null);s.default=r.exports}}]);