(window.webpackJsonp=window.webpackJsonp||[]).push([[46],{336:function(t,a,s){"use strict";s.r(a);var e=s(10),n=Object(e.a)({},(function(){var t=this,a=t._self._c;return a("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[a("h1",{attrs:{id:"goner-xorm-user-guide"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#goner-xorm-user-guide"}},[t._v("#")]),t._v(" "),a("code",[t._v("goner/xorm")]),t._v(" User Guide")]),t._v(" "),a("h2",{attrs:{id:"import-and-loading"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#import-and-loading"}},[t._v("#")]),t._v(" Import and Loading")]),t._v(" "),a("ul",[a("li",[a("p",[t._v("Import the "),a("code",[t._v("goner")]),t._v(" package:")]),t._v(" "),a("div",{staticClass:"language-go extra-class"},[a("pre",{pre:!0,attrs:{class:"language-go"}},[a("code",[a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"github.com/gone-io/gone/goner"')]),t._v("\n")])])])]),t._v(" "),a("li",[a("p",[t._v("Import database driver packages as needed:")]),t._v(" "),a("ul",[a("li",[t._v("MySQL driver:"),a("div",{staticClass:"language-go extra-class"},[a("pre",{pre:!0,attrs:{class:"language-go"}},[a("code",[a("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("_")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"github.com/go-sql-driver/mysql"')]),t._v("\n")])])])]),t._v(" "),a("li",[t._v("SQLite3 driver:"),a("div",{staticClass:"language-go extra-class"},[a("pre",{pre:!0,attrs:{class:"language-go"}},[a("code",[a("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("_")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"github.com/mattn/go-sqlite3"')]),t._v("\n")])])])]),t._v(" "),a("li",[t._v("PostgreSQL driver:"),a("div",{staticClass:"language-go extra-class"},[a("pre",{pre:!0,attrs:{class:"language-go"}},[a("code",[a("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("_")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"github.com/lib/pq"')]),t._v("\n")])])])]),t._v(" "),a("li",[t._v("Oracle driver:"),a("div",{staticClass:"language-go extra-class"},[a("pre",{pre:!0,attrs:{class:"language-go"}},[a("code",[a("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("_")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"github.com/mattn/go-oci8"')]),t._v("\n")])])])]),t._v(" "),a("li",[t._v("MSSQL driver:"),a("div",{staticClass:"language-go extra-class"},[a("pre",{pre:!0,attrs:{class:"language-go"}},[a("code",[a("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("_")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"github.com/denisenkom/go-mssqldb"')]),t._v("\n")])])])])])]),t._v(" "),a("li",[a("p",[t._v("Load components into the "),a("code",[t._v("gone")]),t._v(" framework:")]),t._v(" "),a("div",{staticClass:"language-go extra-class"},[a("pre",{pre:!0,attrs:{class:"language-go"}},[a("code",[a("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("_")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" goner"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("XormPriest")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("cemetery"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])])])])]),t._v(" "),a("h2",{attrs:{id:"configuration"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#configuration"}},[t._v("#")]),t._v(" Configuration")]),t._v(" "),a("table",[a("thead",[a("tr",[a("th",{staticStyle:{"text-align":"left"}},[t._v("Option")]),t._v(" "),a("th",{staticStyle:{"text-align":"center"}},[t._v("Required")]),t._v(" "),a("th",[t._v("Default")]),t._v(" "),a("th",[t._v("Description")])])]),t._v(" "),a("tbody",[a("tr",[a("td",{staticStyle:{"text-align":"left"}},[a("strong",[t._v("database.cluster.enable")])]),t._v(" "),a("td",{staticStyle:{"text-align":"center"}},[t._v("No")]),t._v(" "),a("td",[a("code",[t._v("false")])]),t._v(" "),a("td",[t._v("Enables cluster mode.")])]),t._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"left"}},[a("strong",[t._v("database.driver-name")])]),t._v(" "),a("td",{staticStyle:{"text-align":"center"}},[t._v("Yes (non-cluster)")]),t._v(" "),a("td",[t._v("-")]),t._v(" "),a("td",[t._v("Database driver name. Supported: "),a("code",[t._v("mysql")]),t._v(", "),a("code",[t._v("sqlite3")]),t._v(", "),a("code",[t._v("postgres")]),t._v(", "),a("code",[t._v("oracle")]),t._v(", "),a("code",[t._v("mssql")]),t._v(".")])]),t._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"left"}},[a("strong",[t._v("database.dsn")])]),t._v(" "),a("td",{staticStyle:{"text-align":"center"}},[t._v("Yes (non-cluster)")]),t._v(" "),a("td",[t._v("-")]),t._v(" "),a("td",[t._v("Database connection string.")])]),t._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"left"}},[a("strong",[t._v("database.max-idle-count")])]),t._v(" "),a("td",{staticStyle:{"text-align":"center"}},[t._v("No")]),t._v(" "),a("td",[a("code",[t._v("5")])]),t._v(" "),a("td",[t._v("Maximum number of idle connections in the pool.")])]),t._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"left"}},[a("strong",[t._v("database.max-open")])]),t._v(" "),a("td",{staticStyle:{"text-align":"center"}},[t._v("No")]),t._v(" "),a("td",[a("code",[t._v("20")])]),t._v(" "),a("td",[t._v("Maximum number of open connections in the pool.")])]),t._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"left"}},[a("strong",[t._v("database.max-lifetime")])]),t._v(" "),a("td",{staticStyle:{"text-align":"center"}},[t._v("No")]),t._v(" "),a("td",[a("code",[t._v("10m")])]),t._v(" "),a("td",[t._v("Maximum lifetime of a connection.")])]),t._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"left"}},[a("strong",[t._v("database.show-sql")])]),t._v(" "),a("td",{staticStyle:{"text-align":"center"}},[t._v("No")]),t._v(" "),a("td",[a("code",[t._v("true")])]),t._v(" "),a("td",[t._v("Enables SQL logging.")])]),t._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"left"}},[a("strong",[t._v("database.cluster.master.driver-name")])]),t._v(" "),a("td",{staticStyle:{"text-align":"center"}},[t._v("Yes (cluster)")]),t._v(" "),a("td",[t._v("-")]),t._v(" "),a("td",[t._v("Driver name for the master database. Supported: "),a("code",[t._v("mysql")]),t._v(", "),a("code",[t._v("sqlite3")]),t._v(", "),a("code",[t._v("postgres")]),t._v(", "),a("code",[t._v("oracle")]),t._v(", "),a("code",[t._v("mssql")]),t._v(".")])]),t._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"left"}},[a("strong",[t._v("database.cluster.master.dsn")])]),t._v(" "),a("td",{staticStyle:{"text-align":"center"}},[t._v("Yes (cluster)")]),t._v(" "),a("td",[t._v("-")]),t._v(" "),a("td",[t._v("Connection string for the master database.")])]),t._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"left"}},[a("strong",[t._v("database.cluster.slaves[n].driver-name")])]),t._v(" "),a("td",{staticStyle:{"text-align":"center"}},[t._v("Yes (cluster)")]),t._v(" "),a("td",[t._v("-")]),t._v(" "),a("td",[t._v("Driver name for a slave database. Supported: "),a("code",[t._v("mysql")]),t._v(", "),a("code",[t._v("sqlite3")]),t._v(", "),a("code",[t._v("postgres")]),t._v(", "),a("code",[t._v("oracle")]),t._v(", "),a("code",[t._v("mssql")]),t._v(".")])]),t._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"left"}},[a("strong",[t._v("database.cluster.slaves[n].dsn")])]),t._v(" "),a("td",{staticStyle:{"text-align":"center"}},[t._v("Yes (cluster)")]),t._v(" "),a("td",[t._v("-")]),t._v(" "),a("td",[t._v("Connection string for a slave database.")])])])]),t._v(" "),a("h3",{attrs:{id:"non-cluster-example"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#non-cluster-example"}},[t._v("#")]),t._v(" Non-Cluster Example")]),t._v(" "),a("div",{staticClass:"language-ini extra-class"},[a("pre",{pre:!0,attrs:{class:"language-ini"}},[a("code",[a("span",{pre:!0,attrs:{class:"token key attr-name"}},[t._v("database.driver-name")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token value attr-value"}},[t._v("mysql")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token key attr-name"}},[t._v("database.dsn")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token value attr-value"}},[t._v("root:123456@tcp(127.0.0.1:3306)/test?charset=utf8mb4&parseTime=True&loc=Local")]),t._v("\n")])])]),a("h3",{attrs:{id:"cluster-mode-example"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#cluster-mode-example"}},[t._v("#")]),t._v(" Cluster Mode Example")]),t._v(" "),a("div",{staticClass:"language-ini extra-class"},[a("pre",{pre:!0,attrs:{class:"language-ini"}},[a("code",[a("span",{pre:!0,attrs:{class:"token key attr-name"}},[t._v("database.cluster.enable")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token value attr-value"}},[t._v("true")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# Master database configuration")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token key attr-name"}},[t._v("database.cluster.master.driver-name")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token value attr-value"}},[t._v("mysql")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token key attr-name"}},[t._v("database.cluster.master.dsn")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token value attr-value"}},[t._v("root:123456@tcp(master-db-host:3306)/test?charset=utf8mb4&parseTime=True&loc=Local")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# Slave database configuration")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token key attr-name"}},[t._v("database.cluster.slaves[0].driver-name")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token value attr-value"}},[t._v("mysql")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token key attr-name"}},[t._v("database.cluster.slaves[0].dsn")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token value attr-value"}},[t._v("root:123456@tcp(slave-db-0-host:3306)/test?charset=utf8mb4&parseTime=True&loc=Local")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token key attr-name"}},[t._v("database.cluster.slaves[1].driver-name")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token value attr-value"}},[t._v("mysql")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token key attr-name"}},[t._v("database.cluster.slaves[1].dsn")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token value attr-value"}},[t._v("root:123456@tcp(slave-db-1-host:3306)/test?charset=utf8mb4&parseTime=True&loc=Local")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token key attr-name"}},[t._v("database.cluster.slaves[2].driver-name")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token value attr-value"}},[t._v("mysql")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token key attr-name"}},[t._v("database.cluster.slaves[2].dsn")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token value attr-value"}},[t._v("root:123456@tcp(slave-db-1-host:3306)/test?charset=utf8mb4&parseTime=True&loc=Local")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# ... additional slave databases")]),t._v("\n")])])]),a("h2",{attrs:{id:"injecting-database-engines-in-code"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#injecting-database-engines-in-code"}},[t._v("#")]),t._v(" Injecting Database Engines in Code")]),t._v(" "),a("div",{staticClass:"language-go extra-class"},[a("pre",{pre:!0,attrs:{class:"language-go"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"github.com/gone-io/gone"')]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("type")]),t._v(" dbUser "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("struct")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n\tgone"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("Flag\n\tdb gone"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("XormEngine "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('`gone:"*"`')]),t._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// Inject the database engine. In cluster mode, this injects the database cluster. Queries use slave databases randomly; writes use the master database.")]),t._v("\n\tmasterDb gone"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("XormEngine "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('`gone:"xorm,master"`')]),t._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// Inject the master database. Effective in cluster mode.")]),t._v("\n\tslaveDb0 gone"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("XormEngine "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('`gone:"xorm,slave=0"`')]),t._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// Inject slave database 0. Effective in cluster mode.")]),t._v("\n\tslaveDb1 gone"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("XormEngine "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('`gone:"xorm,slave=1"`')]),t._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// Inject slave database 1. Effective in cluster mode.")]),t._v("\n\tslaveDbs "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("gone"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("XormEngine "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('`gone:"xorm"`')]),t._v("      "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// Inject a slice of slave databases. Effective in cluster mode.")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("type")]),t._v(" Book "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("struct")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n\tId    "),a("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("int64")]),t._v("\n\tTitle "),a("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("string")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("func")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("d "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),t._v("dbUser"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("GetBookById")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("id "),a("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("int64")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("book "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),t._v("Book"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" err "),a("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("error")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n\tbook "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("new")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("Book"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\thas"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" err "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":=")]),t._v(" d"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("db"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("Where")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"id=?"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" id"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("Get")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("book"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\t"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" err "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("!=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("nil")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n\t\t"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("nil")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" gone"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("ToError")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("err"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\t"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\t"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("!")]),t._v("has "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n\t\t"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("nil")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" gone"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("NewParameterError")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"book not found"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("404")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\t"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\t"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" book"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("nil")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),a("h2",{attrs:{id:"multi-database-support"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#multi-database-support"}},[t._v("#")]),t._v(" Multi-Database Support")]),t._v(" "),a("h3",{attrs:{id:"_1-configuring-multiple-databases"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1-configuring-multiple-databases"}},[t._v("#")]),t._v(" 1. Configuring Multiple Databases")]),t._v(" "),a("p",[t._v("Configuration prefixes follow the pattern "),a("code",[t._v("database.{name}")]),t._v(" (e.g., "),a("code",[t._v("database.db1")]),t._v(", "),a("code",[t._v("database.db2")]),t._v(").")]),t._v(" "),a("table",[a("thead",[a("tr",[a("th",{staticStyle:{"text-align":"left"}},[t._v("Option")]),t._v(" "),a("th",{staticStyle:{"text-align":"center"}},[t._v("Required")]),t._v(" "),a("th",[t._v("Default")]),t._v(" "),a("th",[t._v("Description")])])]),t._v(" "),a("tbody",[a("tr",[a("td",{staticStyle:{"text-align":"left"}},[a("strong",[t._v("{prefix}.cluster.enable")])]),t._v(" "),a("td",{staticStyle:{"text-align":"center"}},[t._v("No")]),t._v(" "),a("td",[a("code",[t._v("false")])]),t._v(" "),a("td",[t._v("Enables cluster mode.")])]),t._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"left"}},[a("strong",[t._v("{prefix}.driver-name")])]),t._v(" "),a("td",{staticStyle:{"text-align":"center"}},[t._v("Yes (non-cluster)")]),t._v(" "),a("td",[t._v("-")]),t._v(" "),a("td",[t._v("Database driver name. Supported: "),a("code",[t._v("mysql")]),t._v(", "),a("code",[t._v("sqlite3")]),t._v(", "),a("code",[t._v("postgres")]),t._v(", "),a("code",[t._v("oracle")]),t._v(", "),a("code",[t._v("mssql")]),t._v(".")])]),t._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"left"}},[a("strong",[t._v("{prefix}.dsn")])]),t._v(" "),a("td",{staticStyle:{"text-align":"center"}},[t._v("Yes (non-cluster)")]),t._v(" "),a("td",[t._v("-")]),t._v(" "),a("td",[t._v("Database connection string.")])]),t._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"left"}},[a("strong",[t._v("{prefix}.max-idle-count")])]),t._v(" "),a("td",{staticStyle:{"text-align":"center"}},[t._v("No")]),t._v(" "),a("td",[a("code",[t._v("5")])]),t._v(" "),a("td",[t._v("Maximum number of idle connections in the pool.")])]),t._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"left"}},[a("strong",[t._v("{prefix}.max-open")])]),t._v(" "),a("td",{staticStyle:{"text-align":"center"}},[t._v("No")]),t._v(" "),a("td",[a("code",[t._v("20")])]),t._v(" "),a("td",[t._v("Maximum number of open connections in the pool.")])]),t._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"left"}},[a("strong",[t._v("{prefix}.max-lifetime")])]),t._v(" "),a("td",{staticStyle:{"text-align":"center"}},[t._v("No")]),t._v(" "),a("td",[a("code",[t._v("10m")])]),t._v(" "),a("td",[t._v("Maximum lifetime of a connection.")])]),t._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"left"}},[a("strong",[t._v("{prefix}.show-sql")])]),t._v(" "),a("td",{staticStyle:{"text-align":"center"}},[t._v("No")]),t._v(" "),a("td",[a("code",[t._v("true")])]),t._v(" "),a("td",[t._v("Enables SQL logging.")])]),t._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"left"}},[a("strong",[t._v("{prefix}.cluster.master.driver-name")])]),t._v(" "),a("td",{staticStyle:{"text-align":"center"}},[t._v("Yes (cluster)")]),t._v(" "),a("td",[t._v("-")]),t._v(" "),a("td",[t._v("Driver name for the master database. Supported: "),a("code",[t._v("mysql")]),t._v(", "),a("code",[t._v("sqlite3")]),t._v(", "),a("code",[t._v("postgres")]),t._v(", "),a("code",[t._v("oracle")]),t._v(", "),a("code",[t._v("mssql")]),t._v(".")])]),t._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"left"}},[a("strong",[t._v("{prefix}.cluster.master.dsn")])]),t._v(" "),a("td",{staticStyle:{"text-align":"center"}},[t._v("Yes (cluster)")]),t._v(" "),a("td",[t._v("-")]),t._v(" "),a("td",[t._v("Connection string for the master database.")])]),t._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"left"}},[a("strong",[t._v("{prefix}.cluster.slaves[n].driver-name")])]),t._v(" "),a("td",{staticStyle:{"text-align":"center"}},[t._v("Yes (cluster)")]),t._v(" "),a("td",[t._v("-")]),t._v(" "),a("td",[t._v("Driver name for a slave database. Supported: "),a("code",[t._v("mysql")]),t._v(", "),a("code",[t._v("sqlite3")]),t._v(", "),a("code",[t._v("postgres")]),t._v(", "),a("code",[t._v("oracle")]),t._v(", "),a("code",[t._v("mssql")]),t._v(".")])]),t._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"left"}},[a("strong",[t._v("{prefix}.cluster.slaves[n].dsn")])]),t._v(" "),a("td",{staticStyle:{"text-align":"center"}},[t._v("Yes (cluster)")]),t._v(" "),a("td",[t._v("-")]),t._v(" "),a("td",[t._v("Connection string for a slave database.")])])])]),t._v(" "),a("h3",{attrs:{id:"_2-injecting-multiple-databases"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2-injecting-multiple-databases"}},[t._v("#")]),t._v(" 2. Injecting Multiple Databases")]),t._v(" "),a("div",{staticClass:"language-go extra-class"},[a("pre",{pre:!0,attrs:{class:"language-go"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"github.com/gone-io/gone"')]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("type")]),t._v(" dbUser "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("struct")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n\tgone"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("Flag\n\n\t"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// Inject the database engine for `database.db1`.")]),t._v("\n\tdb1 gone"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("XormEngine "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('`gone:"xorm,db=database.db1"`')]),t._v("\n\n\t"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// Inject the master database for `database.db1`.")]),t._v("\n\tmasterDb gone"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("XormEngine "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('`gone:"xorm,db=database.db1,master"`')]),t._v("\n\n\t"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// Inject slave database 0 for `database.db1`.")]),t._v("\n\tslaveDb0 gone"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("XormEngine "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('`gone:"xorm,db=database.db1,slave=0"`')]),t._v("\n\n\t"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// Inject slave database 1 for `database.db1`.")]),t._v("\n\tslaveDb1 gone"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("XormEngine "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('`gone:"xorm,db=database.db1,slave=1"`')]),t._v("\n\n\t"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// Inject a slice of slave databases for `database.db1`.")]),t._v("\n\tslaveDbs "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("gone"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("XormEngine "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('`gone:"xorm,db=database.db1"`')]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),a("h2",{attrs:{id:"enhancements-to-xorm-in-gone"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#enhancements-to-xorm-in-gone"}},[t._v("#")]),t._v(" Enhancements to Xorm in Gone")]),t._v(" "),a("h3",{attrs:{id:"_1-automatic-transactions"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1-automatic-transactions"}},[t._v("#")]),t._v(" 1. Automatic Transactions")]),t._v(" "),a("p",[t._v("Use the "),a("code",[t._v("Transaction")]),t._v(" function to wrap database operations. A transaction is automatically started, and if an "),a("code",[t._v("error")]),t._v(" is returned or a "),a("code",[t._v("panic")]),t._v(" occurs, the transaction will roll back. Otherwise, it will commit automatically.")]),t._v(" "),a("blockquote",[a("p",[a("strong",[t._v("Note")]),t._v(": Database operations in a "),a("code",[t._v("Transaction")]),t._v(" must use a "),a("code",[t._v("session")]),t._v(" of type "),a("code",[t._v("xorm.Interface")]),t._v(".")])]),t._v(" "),a("div",{staticClass:"language-go extra-class"},[a("pre",{pre:!0,attrs:{class:"language-go"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("type")]),t._v(" db "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("struct")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n\tgone"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("Flag\n\tgone"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("XormEngine "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('`gone:"gone-xorm"`')]),t._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// Inject the database engine.")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("func")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("d "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),t._v("db"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("updateUser")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("user "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),t._v("entity"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("User"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("error")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n\t"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// Wrap the operation with Transaction to automatically handle commits/rollbacks.")]),t._v("\n\t"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" d"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("Transaction")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("func")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("session xorm"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("Interface"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("error")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n\t\t"),a("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("_")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" err "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":=")]),t._v(" session"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("ID")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("user"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("Id"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("Update")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("user"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\t\t"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" gone"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("ToError")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("err"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\t"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),a("h3",{attrs:{id:"_2-nested-transactions"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2-nested-transactions"}},[t._v("#")]),t._v(" 2. Nested Transactions")]),t._v(" "),a("p",[t._v("Nested transactions automatically propagate into a single transaction. If one nested transaction returns an "),a("code",[t._v("error")]),t._v(" or a "),a("code",[t._v("panic")]),t._v(" occurs, the entire transaction will roll back.")]),t._v(" "),a("div",{staticClass:"language-go extra-class"},[a("pre",{pre:!0,attrs:{class:"language-go"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("func")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("d "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),t._v("db"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("updateUser")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("user "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),t._v("entity"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("User"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("error")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n\t"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" d"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("Transaction")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("func")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("session xorm"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("Interface"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("error")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n")])])])])}),[],!1,null,null,null);a.default=n.exports}}]);