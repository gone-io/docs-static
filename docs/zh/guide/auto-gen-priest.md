---
sidebar: auto
prev: ./tracer
next: false
---

# 自动生成Priest
[[toc]]
[什么是Priest?](./core-concept.md)

## 小试牛刀
`gone priest`命令可以扫描代码中的特殊注释`//go:gone`生成Priest函数；`//go:gone`暂时只能用于标记`func () gone.Goner` 和 `func () (gone.Goner, gone.GonerId)`这两种形式的函数，函数必须是公开（以大写字母开头）。

### 1. 安装gone辅助工具
执行如下命令：
```bash
go install github.com/gone-io/gone/tools/gone@latest
```
gone更多内容参考文档 [gone辅助工具](../references/gone-tool.md)

### 2. 编写Goner
创建项目，创建文件：
```bash
mkdir demo
cd demo
go mod init demo
touch demo.go
```

编辑demo.go文件代码如下：
```go
package demo

import "github.com/gone-io/gone"

//go:gone
func NewDemo() gone.Goner {
	return &Demo{}
}

type Demo struct {
	gone.Flag
}
```

### 3. 生成代码
执行
```bash
gone priest -s ./ -f Priest -o priest.go -p demo
```
将生成文件：priest.go
内容如下：
```go
// Code generated by gone; DO NOT EDIT.
package demo
import (
    "github.com/gone-io/gone"
)

func Priest(cemetery gone.Cemetery) error {
    cemetery.Bury(NewDemo())
	return nil
}
```

## 最佳实践
- 创建一个MasterPriest函数，用于Gone框架的启动；
- 在MasterPriest函数中，调用项目依赖包的Priest函数；
- 将“gone priest”命令放到MasterPriest函数的`//go:generate`注释后，例如：
```go
package internal

import (
	"github.com/gone-io/gone"
	"github.com/gone-io/gone/goner"
)

//go:generate gone priest -s . -p $GOPACKAGE -f Priest -o priest.go
func MasterPriest(cemetery gone.Cemetery) error {
	//调用项目依赖包的Priest函数
    _ = goner.GinPriest(cemetery)

    //调用生成的Priest函数
	_ = Priest(cemetery)
	return nil
}
```
> tips: 运行`go generate ./...` 会执行 所有`//go:generate`注释后的命令；

- 在MasterPriest函数中，调用调用生成的Priest函数；
- git忽略掉生成文件，将生成的文件加入到`.gitignore`文件中。

按照上面逻辑，我们编写了一个可供参考的Web空白项目[Demo](https://github.com/gone-io/examples/tree/main/empty)，已经放到github上，快点击打开吧；另外也可以运行`gone create web-app`生成一个空白项目，参考[快速开始
](https://goner.fun/zh/quick-start/)。